\documentclass{article}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{fullpage}
\usepackage[utf8]{inputenc}


\begin{document}


\author{Sébastien Boisvert}
\title{Instruction Manual for the Ray \emph{de novo} genome assembler software}
\maketitle


\vspace{2cm}
Ray version 1.4.0

\vspace{2cm}

\href{http://denovoassembler.sf.net}{http://denovoassembler.sf.net}

\vspace{2cm}

Reference to cite: 
\vspace{2cm}

\noindent
Sébastien Boisvert, François Laviolette \& Jacques Corbeil.\\
Ray: simultaneous assembly of reads from a mix of high-throughput sequencing technologies.\\
\emph{Journal of Computational Biology} (Mary Ann Liebert, Inc. publishers, New York, U.S.A.).\\
November 2010, Volume 17, Issue 11, Pages 1519-1533.\\
doi:10.1089/cmb.2009.0238\\
\href{http://dx.doi.org/doi:10.1089/cmb.2009.0238}{http://dx.doi.org/doi:10.1089/cmb.2009.0238}


\newpage
\tableofcontents
\newpage

\section{Installation}

To install Ray, you need a C++ compiler, make and an MPI implementation compliant
with MPI standard 2.2.

Ray runs on any POSIX-compliant system. This includes GNU/Linux.
Windows users need to install Cygwin although Ray is not tested on Cygwin.

The software below are readily available in most GNU/Linux distributions (Table~\ref{software}).

\begin{table}[h]
\caption{Suggested software}\label{software}
\begin{tabular}{ll}
\hline
Software & Name \\
\hline
C++ compiler & GNU g++ \\
MPI implementation & Open-MPI \\
\hline
\end{tabular}
\end{table}

There are some compilation flags that can be changed. These are listed below in Table~\ref{flags}.


\begin{table}[h]
\caption{Compilation flags}\label{flags}
\begin{tabular}{ll}
\hline
Flag & Effect  \\
\hline
HAVE\_ZLIB & enable support for .gz files \\
HAVE\_LIBBZ2 & enable support for .bz2 files \\
FORCE\_PACKING & enable packing of structures and classes\\
ASSERT & enable assertions in the code \\
HAVE\_CLOCK\_GETTIME & get time at a nanosecond precision -- real-time \\
\hline
\end{tabular}
\end{table}

The source code of Ray can be compiled with a Makefile.
You need to have mpic++ in your path, otherwise edit the Makefile to change CC.


\begin{verbatim}
make 
ls -l code/Ray
\end{verbatim}

\section{Inputs}

The input files for Ray contain sequences. The files must be formatted in one of the supported formats.
These formats are listed in Table~\ref{formats}. Note that the file extension is obligatory and Ray uses it
to select the file format.

\begin{table}[h]
\caption{File formats compatible with the Ray \emph{de novo} genome assembler software}\label{formats}
\begin{tabular}{lll}
\hline
Format & Obligatory extension \\
\hline
Fasta format & .fasta\\
Fasta format, compressed with GNU zip (gzip) & .fasta.gz \\
Fasta format, compressed with bzip2 & .fasta.bz2 \\
Fastq format & .fastq\\
Fastq format, compressed with GNU zip (gzip) & .fastq.gz \\
Fastq format, compressed with bzip2 & .fastq.bz2 \\
Standard flowgram format & .sff \\
\hline
\end{tabular}
\end{table}



\section{Parameters}

Ray assembles reads (paired or not) to produce an assembly.
Paired reads must be on opposite strands (forward \& reverse or reverse \& forward).

For a paired library, paired reads can be provided as two files (with -p) or as one file containing interleaved
sequences (with -i).
With both, the average outer distance and the standard deviation can be provided by the user. Otherwise, these values are
computed by Ray.
The maximum  number of paired libraries allowed by Ray is 499.




\subsection{$k$-mer length with -k}

Ray builds a distributed catalog of all occuring $k$-mers in the reads and their reverse-complement. $k$ must be greater or equal to 15 and lower or equal to 31. The $k$-mer length must be an odd number.

\subsection{Output prefix with -o}

Output files are named according to the prefix provided by the option -o.

\subsection{Single-end reads with -s}

\begin{verbatim}
-s <sequencesFile>
\end{verbatim}

\subsection{Paired-end reads and mate-pair reads with -p}

Average outer distance and standard deviation are computed by Ray if omitted.

\begin{verbatim}
-p <leftSequencesFile> <rightSequencesFile>  

OR

-p <leftSequencesFile> <rightSequencesFile>  <averageFragmentLength> <standardDeviation> 
\end{verbatim}

Example for paired-end reads (the ends of DNA fragments):

\begin{verbatim}
-p s_200_1.fastq s_200_2.fastq
\end{verbatim}

Example for mate-pair reads:

\begin{verbatim}
-p s_20000_1.fastq s_20000_2.fastq
\end{verbatim}

Example with metagenomic data and user-provided average outer distance and standard deviation

\begin{verbatim}
-p s_1.fastq s_2.fastq 300 30
\end{verbatim}

\subsection{Paired-end reads and mate-pair reads with -i (interleaved sequences)}


Average outer distance and standard deviation are computed by Ray if omitted.

\begin{verbatim}
-i <sequencesFile>

OR

-i <sequencesFile>  <averageFragmentLength> <standardDeviation> 
\end{verbatim}

In the interleaved file (example is for a fasta file):

\begin{verbatim}
>200_1_1234/1
ATCGATCGATCGACTCAGACACGTACG
>200_1_1234/2
ACTGACGACGTACGACGTCATGCAACT
...
\end{verbatim}



\section{Outputs}

\begin{table}[h]
\caption{File formats compatible with the Ray \emph{de novo} genome assembler software}\label{formats}
\begin{tabular}{lll}
\hline
File& Description\\
\hline
PREFIX.RayCommand.txt & The exact same command provided \\
PREFIX.RayVersion.txt & The version of Ray\\
PREFIX.Contigs.fasta & Contiguous sequences in FASTA format\\
PREFIX.ContigLengths.txt & The lengths of contiguous sequences\\
PREFIX.Scaffolds.fasta & The scaffold sequences in FASTA format \\
PREFIX.ScaffoldComponents.txt & The components of each scaffold\\
PREFIX.ScaffoldLengths.txt & The length of each scaffold \\
PREFIX.ScaffoldLinks.txt & Scaffold links \\
PREFIX.CoverageDistribution.txt & The distribution of coverage values \\
PREFIX.CoverageDistributionAnalysis.txt & Analysis of the coverage distribution \\
PREFIX.LibraryStatistics.txt & Number of reads in each file and estimation of outer distances for paired reads \\
PREFIX.SeedLengthDistribution.txt & The distribution of seed lengths \\
PREFIX.OutputNumbers.txt & Overall numbers for the assembly\\
PREFIX.AMOS.afg & Assembly representation in AMOS format \\
\hline
\end{tabular}
\end{table}


\section{Validation of assemblies}

In the scripts/ directory, the script ValidateGenomeAssembly.sh can validate an assembly against the corresponding
reference.

\section{Example}

\subsection{Bacterial genome with paired-end and mate-pair short reads}

The command:

\begin{verbatim}
mpirun -np 32 ~/Ray/trunk/code/Ray \
-p /home/boiseb01/nuccore/Large-Ecoli/200_1.fastq \
   /home/boiseb01/nuccore/Large-Ecoli/200_2.fastq \
-p /home/boiseb01/nuccore/Large-Ecoli/1000_1.fastq \
   /home/boiseb01/nuccore/Large-Ecoli/1000_2.fastq \
-p /home/boiseb01/nuccore/Large-Ecoli/4000_1.fastq \
   /home/boiseb01/nuccore/Large-Ecoli/4000_2.fastq \
-p /home/boiseb01/nuccore/Large-Ecoli/10000_1.fastq \
   /home/boiseb01/nuccore/Large-Ecoli/10000_2.fastq \
-o BacterialGenome | tee RayLog
\end{verbatim}

\section{Virtual sequencer \& simulations}

The Ray package includes a simulator for paired reads.

\begin{verbatim}
N=6000000
readLength=50
errorRate=0.005
ref=~/nuccore/Ecoli-k12-mg1655.fasta

g++ code/simulatePairedReads.cpp -O3 -Wall -o Simulator 
./Simulator $ref $errorRate 200 20 $N $readLength L1_1.fasta L1_2.fasta
\end{verbatim}

\section{Exploring the source code}

Ray source code is documented with Doxygen standards.

The command below generates code documentation.

\begin{verbatim}
doxygen DoxygenConfigurationFile
\end{verbatim}

To browse it, use this command:

\begin{verbatim}
firefox DoxygenDocumentation/html/index.html
\end{verbatim}

\section{Reporting bugs \& crashes}

\begin{verbatim}
On the mailing list:
denovoassembler-users # lists DOT sourceforge.net

or personal email:
sebastien.boisvert.3 # ulaval DOT ca  or seb # boisvert DOT info
\end{verbatim}

\noindent
Elements to send:

\begin{enumerate}
 \item Ray command including mpirun
  \item Ray standard output: mpirun -np 32 /path/to/Ray -p p\_1.fastq p\_2.fastq -o Out $|$\& tee Log; gzip Log; ls -lh Log.gz
    \item  C++ compiler name (examples: GNU g++, Intel ICC, or other) and version (usually $--$version)
   \item  MPI library name (examples: Open-MPI, MPICH2, or other) and version (usually $--$version)
    \item  Sequencer vendor and model that generated reads
    \item  Total physical memory of the system and physical memory available for each MPI ranks
\item Job scheduler (examples: Grid Engine, PBS, none or other)
\end{enumerate}

\noindent
Also, if you have access to compute nodes:

\begin{enumerate}
\setcounter{enumi}{7}
   \item Memory page size: getconf PAGESIZE $>$ pagesize
   \item Central processing unit: cat /proc/cpuinfo|gzip$>$ cpuinfo.gz
   \item Memory information: cat /proc/meminfo|gzip$>$ meminfo.gz
   \item Kernel: uname -a$>$ uname-a 
\end{enumerate}
\end{document}
